命令行参数 
==========================

OBDUMPER 通过命令行参数指定导出时所需的信息。 

命令示例 
-------------------------

导出命令的示例语句如下，关于参数的详细信息和更多的使用示例，请参见 [命令示例](#section-2n1-ue0-z9m) 与 [常见场景](../2.obdumper-user-guide/6.obdumper-scenarios.md)。
**注意**



当连接至 OceanBase DataBase Proxy（OBProxy） 时，参数 `-h` 和 `-P` 的值为 OBProxy 的主机 IP 和端口号，并且需要使用参数 `-c` 指定连接的集群名。当直接连接至 OBServer 时，不需要使用参数 `-c` 指定连接的集群名。

```javascript
[admin@localhost]>./obdumper -h <主机IP> -P <端口> -u <用户> -p <密码> --sys-password <sys租户某用户密码> -c <集群> -t <租户> -D <--database> [--ddl] [--csv|--sql|--cut] [--all|--table '表名'] -f<数据目录>
```



参数列表 
-------------------------



|           参数           | 是否必选 |                                                                                                                                                                                                                                                                                                                                                                  说明                                                                                                                                                                                                                                                                                                                                                                   |
|------------------------|------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| -h(--host)             | 是    | 连接 OBProxy 或者直连 OBServer 的主机地址。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -P(--port)             | 是    | 连接 OBProxy 或者直连 OBServer 的主机端口。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -c(--cluster)          | 否    | 数据库的集群名。直连 OBServer 时无需指定。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| -t(--tenant)           | 否    | 当前用户的租户名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| -u(--user)             | 是    | 数据库用户名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| -p(--password)         | 否    | 数据库密码。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| -D(--database)         | 是    | 数据库名。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| -f(--file-path)        | 是    | 指定数据导出的目录。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --skip-check-dir       | 否    | 默认数据导出目录必须为空，指定该参数跳过导出数据目录为空检查。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --sys-user             | 否    | 指定 sys 租户下某用户的用户名，默认值 root@sys。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --sys-password         | 否    | 指定 sys 租户下某用户的密码，默认值为空。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| --public-cloud         | 否    | 使用简易模式导出数据，该模式导出不依赖 --sys-user。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --log-path             | 否    | 指定日志文件的输出目录。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| --file-encoding        | 否    | 指定文件编码，默认值 UTF-8。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| --csv                  | 否    | 导出 CSV 文件，默认的文件后缀是 .csv（推荐）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| --sql                  | 否    | 导出 SQL 文件，默认的文件后缀是 .sql。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --ddl                  | 否    | 导出 DDL 文件，默认的文件后缀是 -schema.sql。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --all                  | 否    | 导出所有的数据库对象（默认为表和视图）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| --table                | 否    | 指定待导出的表，多个表用逗号分隔。 值为 '\*' 时则导出 -D 库中所有的表。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| --view                 | 否    | 指定待导出的视图，多个视图用逗号分隔。值为 '\*' 时则导出 -D 库中所有的视图。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| --drop-object          | 否    | 指定导出 DDL 时，是否要前置追加 `DROP` 语句。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| --snapshot             | 否    | 指定是否导出快照数据，支持导出最近一次合并版本的快照数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| --page-size            | 否    | 指定分页查询的记录数，默认值 10000 行。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| --where                | 否    | 支持指定全局条件导出符合条件的数据。例如 `--where 'age>16 and age<65'`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| --partition            | 否    | 支持导出部分分区内的数据，例如 `-- partition 'p0,p1,p2'`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --flashback-scn        | 否    | 指定从最近有效的 SCN 点导出数据。OceanBase V2.2.70 及以上版本支持该功能。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --flashback-timestamp  | 否    | 指定从最近有效的时间点导出数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --block-size           | 否    | 指定导出文件的大小，默认按 256 M 一个文件大小导出。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| --max-file-size        | 否    | 指定每张表最大的导出量，默认不限制，单位 MB。例如 ` --max-file-size 512`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| --thread               | 否    | 指定数据导出的线程数，默认值 CPU \* 2。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --parallel-macro       | 否    | 每个线程可以读取的宏块数，该参数可以影响性能。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| --exclude-data-types   | 否    | 指定导出数据时，要跳过的与表中匹配的数据类型，比如 BLOB 类型的数据等。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| --retry                | 否    | 是否从最近一次的保存点继续导出。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --skip-header          | 否    | 指定是否生成 CSV 文件头，默认不跳过头，即生成CSV文件头。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --trail-delimiter      | 否    | 如果数据是列分隔符结尾，则去掉行尾最后一个列分隔符。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --null-string          | 否    | 指定 `NULL` 的替代字符，CSV 格式下默认值为 \\N。其它格式默认不作任何处理。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| --empty-string         | 否    | 指定空字符（' '）的转义字符，默认值 \\E。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --line-separator       | 否    | 指定行分隔符，默认值 '\\n'。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| --column-separator     | 否    | 指定列分隔符，默认值 ','（英文逗号）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| --escape-character     | 否    | 指定转义字符，默认值 \\。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| --column-delimiter     | 否    | 指定引号格式为单引号或双引号，默认值 '（单引号）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| --ctl-path             | 否    | 指定控制文件所在目录，控制文件的后缀名是 .ctrl。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| --cut                  | 否    | 导出 CUT 格式文件，CUT 格式是指数据使用字符串作为分隔。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --column-splitter      | 否    | 定义列分隔串，区别于 CSV 格式单字符的分隔符，数据按照指定的字符串进行分隔。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --distinct             | 否    | 针对表中的数据进行去重后再导出。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --exclude-column-names | 否    | 指定表中无需被导出的列，须与 `--table` 参数搭配使用。例如： `--table 'test' --exclude-column-names 'c3,c4'`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| --skip-check-dir       | 否    | 默认数据导出目录必须为空，指定该参数跳过导出数据目录为空检查。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --oss-endpoint         | 否    | 填写 Bucket 所在地域对应的 Endpoint。 如华东1 (杭州)，Endpoint 填写为 https://oss-cn-hangzhou.aliyuncs.com。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --access-key           | 否    | 指定云存储的访问账号。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| --secret-key           | 否    | 指定云存储的访问密钥。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| --bucket-uri           | 否    | 指定存储单元标识符。 URI 格式：oss://bucket/key1/key2 例如：oss://oceanbasepublic/tools/obdumper                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --include-column-names | 否    | 指定需导出的字段以及导出顺序。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| --remove-newline       | 否    | 为部分业务场景设置， **非通用** 的选项。 用于导出数据时，强制删除数据中包含的换行符或者回车符（仅适用于 `--cut` 格式）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| --file-name            | 否    | 实现表数据导出时单表数据文件合并，从而解决导出文件数量过多的问题。 * 使用方法一： `--file-name` 指定具体的文件名，表示将指定表的多个子文件合并成一个文件。这种情况需与 `--table` 参数搭配使用，且 `--table` 仅能指定为单表（如 `--table` 参数中指定多表时，`--file-name` 参数无效）。 示例： * `--table 'test' --file-name 'datafile.txt'`；   * `--table 'test' --file-name '/home/data/datafile.txt'`；     * 使用方法二：`--file-name` 指定为绝对路径，表示将需导出的一个或多个表的数据文件按表维度合并，一个表对应一个数据文件。 示例： `--table '*' --file-name '/home/data/'`； **注意**  存放数据的文件夹内不可包含同名文件。    |
| --add-extra-message    | 否    | 配合 `--ddl` 使用，支持获取表组 `TABLEGROUP`，启用该参数后会在导出的表结构后追加表组信息。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| --weak-read            | 否    | 支持从 OceanBase 集群的备副本中导出数据。 实现原理： 在 sql template 中添加 `/*+READ_CONSISTENCY(WEAK)*/` ```sql select /*+READ_CONSISTENCY(WEAK)*/  [field...] from table ```  **说明**  支持 OBServer 和 OBProxy 版本：OceanBase V3.1.x。                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| --exclude-table        | 否    | * 如指定表名，不导出指定表的结构和数据，例如 `--exclude-table 'a,b,c'`。   * 如不指定表名，则导出所有表结构和表数据，例如 `--exclude-table ''` 。   * 支持用 \* 进行模糊匹配，例如 `--exclude-table '*ab*'`（'\*ab\*'表示表名中包含 ab 字符）。                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| --query-sql            | 否    | * 根据自定义的查询 SQL 导出数据，若该 SQL 查询的结果集为空，则不导出（支持 CUT 、CSV 和 SQL 格式）。 例如：`--cut --query-sql 'select t1.col1,t2.col2 from t1 left join t2 on t1.id=t2.id'`。  **注意**  CSV 格式支持定义定界符、列分隔符 和 换行符。   * 通过将 `--query-sql` 与 `--ctl-path` 参数搭配使用，支持对查询出的数据，根据列名或者列顺序进行数据清洗（支持 CUT 、CSV 和 SQL 格式）。 例如：`--query-sql 'select * from table'  --ctl-path '/home/admin/test.path`'。                                                                                                                                                                                                  |
| --retain-empty-files   | 否    | 支持空表导出。 **说明**  空表对应的数据文件是个空文件。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |


