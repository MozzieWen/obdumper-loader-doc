产品简介 
=========================



什么是 OBDUMPER 
---------------------------------

OBDUMPER 是一款使用 Java 开发的客户端导出工具。可以使用该工具将 OceanBase 数据库中定义的对象和数据导出到文件中。

与 MyDumper 和 SQLDeveloper 等导出工具相比，OBDUMPER 具备以下显著优势：

* 高性能：在无主键表和分区表等场景下，已提供针对性的性能优化。

  

* 多功能：提供数据预处理、多种类型的数据格式和全局一致性非锁定导出数据等功能。

  




产品功能 
-------------------------

OBDUMPER 提供将 OceanBase 数据库中的对象结构和表数据导出到文件中，主要具备以下功能特性：

* 支持导出 Schema 定义语句。

  

* 支持将表中的数据按照 CSV 或者 SQL 格式导出到文件中。

  

* 支持指定分区名，导出部分分区内的表数据。

  

* 支持指定全局的过滤条件，仅导出满足条件的数据。

  

* 支持配置数据预处理规则，导出前对数据进行转换处理。

  

* 支持基于 SCN/TIMESTAMP 闪回查询，保证导出数据的全局一致性。

  

* 支持将导出数据上传到 Aliyun OSS 云存储的功能。

  

* 支持从 OceanBase 的备副本中导出数据。（区别于备集群）

  

* 导出自定义查询结果集时，支持 SQL, CSV, CUT 三种数据格式。

  

* 支持非锁表的情况下，通过读取快照版本来保证导出数据的全局一致性。

  




支持的 OceanBase 数据库 
--------------------------------------

已支持的 OceanBase 数据库模式与版本，如下表所示：


|         **数据库**         |                                        **支持的版本**                                         |
|-------------------------|------------------------------------------------------------------------------------------|
| OceanBase 数据库 Oracle 模式 | 2.2.30、2.2.52、2.2.7x、3.1.x、3.2.x                                                         |
| OceanBase 数据库 MySQL 模式  | 1.4.70、1.4.72、1.4.75、1.4.78、1.4.79、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x |


**注意**



导数工具 3.0.0 版本已支持 OceanBase 社区版 3.1.2 及之后版本。

注意事项 
-------------------------

* 标准的 CSV 格式请参考 RFC 4180 规范，建议导出严格遵从 RFC 4180 规范。

  

* 导出大规模的数据量时，请在运行的脚本中修改虚拟机的内存参数。默认参数：-Xms4G -Xmx4G。

  

* 命令行参数指定的对象名、数据文件名、规则文件名要求大小写一致。Oracle 默认大写，MySQL 默认小写。

  

* 导出数据时建议用户首先触发一次合并，以确保在一定程度上提升导出的性能。

  

* 导出的数据文件统一的命名规范是 table.group.sequence.suffix。

  

* 外键定义包含多列，导出时无法保证列的顺序。例如： FOREIGN KEY(c1,c2) REFERENCE (c1,c2)。

  

* OceanBase MySQL 1.4.72 不支持导出唯一前缀索引的结构定义语句。例如： UNIQUE(c1(10)) 。

  

* OceanBase MySQL 1.4.x 不支持导出生成列的定义语句。例如：GENERATED ALWAYS AS (expr)。

  

* OceanBase Oracle 2.2.50 之前版本中不支持导出函数索引的结构定义语句。

  

* OceanBase MySQL 2.2.7x 不支持导出垂直分区。例如：partition by column。

  

* OceanBase MySQL 2.2.7x 不支持导出同义词。例如：create synonym。

  

* OceanBase MySQL 2.2.7x 不支持导出索引的存储列。例如：storing(column_list)。

  

* 不支持导出 interval day(2) to second(0) 数据类型。例如：'0 5:0:0.000000'。

  

* 截至当前版本，ALL_SOURCE 视图缺少 TYPE 相关信息，OBDUMPER无法导出 TYPE 定义。

  

* Windows 系统不能使用 ！作为分隔符。数据库的对象名同样不能包含 \\ / : \* ? " \< \> \| 等任一种符号，否则结构和数据都将无法正常导出。

  




限制模式 
-------------------------

**说明**



限制模式仅适用于用户无法直接提供 `--sys-user` 和 `--sys-password` 选项的场景。

* 使用限制模式（`--public-cloud`）无需指定 `--sys-user` 和 `--sys-password` 选项。未使用限制模式，OBDUMPER 必须依赖 root@sys 或者 proxyro@sys 两个特定的用户。

  

* 限制模式（`--public-cloud`）仅适用于公共云部署的 OceanBase 集群。无需指定 `-t`, `-c` 连接选项。

  

* 使用限制模式（`--public-cloud`）导出数据时，仅支持导出表中的数据。

  

* 使用限制模式（`--public-cloud`）导出结构时，仅导出 TABLE 和 VIEW 两种对象类型的定义。其中 TABLE 类型的结构不包含索引信息，且导出数据的性能低于非限制版导出数据的性能。

  




使用条件 
-------------------------

当前版本对设置和使用 `undo_retention` 变量具有一定要求。

假设 t1 为撤回（Undo）操作的时间点，且 t2 = t1 + 900s，则在 t2 时间点可以查询到 \[t1,t2\] 区间内的数据。设置 `undo_retention` 后，当前的会话仅对 t1 之后的时间点的数据有效，对 t1 时间点之前的数据无效。该参数默认单位：秒，默认值：0。

设置 `undo_retention` 变量语句如下：

```plaintext
SET global undo_retention=900;
```



* OceanBase 有效的 SCN 可通过视图 `v$ob_timestamp_service` 获取，目前只能在 sys 租户下查询。

  

* 查询固定时间点可查询最近的一次合并版本。例如：在 t1 时间点发起了集群合并，最早可查询到 t1 时间点的数据。

  

* 如果被查询的表已被删除且放置在回收站，则需要先将该表从回收站中恢复。

  

* 闪回查询受限于转储，如果发生转储，且 `undo_retention` 变量未设置，则无法查询。设置 `undo_retention` 变量后，可查询 t1（转储时间点）+ `undo_retention` 变量设置的时间范围。

  



