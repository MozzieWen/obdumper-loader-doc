文件格式 
=========================

本篇旨在介绍 OBLOADER 支持的文件格式以及使用注意事项。

1. CSV, SQL, DDL, CUT, POS 与 MIX 文件格式的区别

   * CSV 格式：文件中存放按照 RFC4180 规范组织的数据。（强烈推荐）

     
   
   * DDL 格式：文件中存放数据库对象的定义语句。即 DDL 语句。

     
   
   * SQL 格式：文件中存放 INSERT 语句，每条记录占一行，请勿换行。

     
   
   * CUT 格式：文件中存放按照字符串分隔的数据，每条记录占一行，请勿换行。

     
   
   * POS 格式：文件中存放按照固定长度的字节偏移位置组织的数据，请勿换行。

     
   
   * MIX 格式：文件中存放任意的 DDL 和 DML 语句混合在一起的文件。（不推荐）

     
   

   

2. 数据文件的格式与文件后缀名的对应关系

   * 默认 CSV 格式的文件后缀为 .csv。

     
   
   * 默认 SQL 格式的文件后缀为 .sql。

     
   
   * DDL 格式的文件后缀为 -schema.sql。除 DDL 格式外其他数据格式的数据文件后缀名可以任意。例如：test 表导出的 CSV 格式的文件名可以为 test.dat，但文件的内容要求为标准的 CSV 格式。导入时在命令中指定文件后缀 `--file-suffix '.dat'` 否则会提示数据文件未找到。

     
   

   

3. 第三方工具（例如：Mydumper 或者 SqlDeveloper 等）导出的数据文件，使用 OBLOADER 导入时的注意事项

   * 导入 CSV 文件，用户需要设置正确的行分隔符、列分隔符、定界符和转义符等。

     
   
   * 导入 SQL 文件，要求 SQL 文件中只有 INSERT 语句，并且每一条数据占一行，避免出现跨行。

     
   
   * 导入 DDL 文件，一个文件对应一个对象的定义，文件中避免出现注释或者开关语句等。

     **说明**

     

     导入数据前须设置正确的日期时间格式。避免在导入过程中，因日期格式不正确造成导入失败。

     
   

   

4. 导入表结构或者表数据的注意事项

   * OceanBase 是串行执行 DDL，并发导入 DDL 不能提升速度 。所以导入表结构无需指定 `--threads` 选项。

     
   
   * 导入数据的性能会受到索引数量的影响。除主键和唯一键以外，普通索引延迟到数据导入结束后再创建。

     
   
   * 导入数据的性能会受到租户的增量内存写入速度的限制。

     * 如果增量内存不足时，数据库会触发合并或者转储。合并比较消耗性能，尽量不要触发。可开启内存的转储，并将转储的次数设置为 100 以上。通常可以坚持 24 小时。

       
     
     * 如果增量内存使用率达到租户限速阈值时，导入性能也会下降。

       
     
     * 如果增量内存使用率已满，很容易导致数据导入失败。建议租户限速的阈值请问高于 90。转储相关参数的设置跟租户内存的大小、写入速度都有关系，需根据实际情况进行调优。

       
     

     
   

   

5. 公共云与私有云的区别

   * 公共云与私有云的 proxyro 权限区别：

     * 公共云：有 proxyro 权限限制，只能限制模式导出表数据以及不完整的表结构和不完整的视图结构。

       
     
     * 私有云：无 proxyro 权限限制，非限制模式可导出数据库中所有已支持的数据库对象定义和表数据。

       
     

     
   
   * 公共云与私有云的连接方式区别：

     * 公共云：通过 `--public-cloud` 选项连接。（不推荐）

       
     
     * 私有云：通过 `--sys-password` 选项或者提供安全密钥文件连接。

       **说明**

       

       公共云限制模式会限制部分导入功能、性能以及稳定性。OceanBase 2.2.30 及之后版本才支持服务端的限流功能，因此在使用限制模式时执行以下命令设置服务端限流：

       ```sql
       alter system set freeze_trigger_percentage=50;
       alter system set minor_merge_concurrence=64;
       alter system set writing_throttling_trigger_percentage=80 tenant='xxx';
       ```

       
       
     

     
   

   



