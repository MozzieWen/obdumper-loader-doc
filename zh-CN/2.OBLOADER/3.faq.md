常见问题 
=========================



产品 FAQ 
---------------------------

### 文档中提到的 CSV、SQL、DDL、CUT、POS 与 MIX 文件格式的区别是什么？ 



### 数据文件的格式与文件后缀名的对应关系是什么? 

数据文件命名格式统一为：table.group.sequence.suffix。

OBLOADER 支持 CSV、SQL、DDL、CUT、POS 和 MIX 共 6 种格式。默认 CSV 格式的文件后缀是 .csv，SQL 格式的文件后缀是 .sql，DDL 格式的文件后缀是 -schema.sql。除 DDL 格式以外其他数据格式的数据文件后缀名可以是任意的。

例如，test 表导出的 CSV 格式的文件名可以是 test.dat，但是文件的内容要求是标准的 CSV 格式。导入时在命令中指定文件后缀 `--file-suffix '.dat'` 否则会提示数据文件未找到。

### 使用 OBLOADER 导入源自第三方工具（如 Mydumper 和 SqlDeveloper 等）导出的数据文件时，有哪些注意事项？ 

* 导入 CSV 文件时，用户需设置正确的符号。例如行分隔符、列分隔符、定界符和转义符等。

  

* 导入 SQL 文件时，要求 SQL 文件中只有 `INSERT` 语句，并且每一条记录占一行，避免出现跨行。

  

* 导入 DDL 文件时，一个文件对应一个对象的定义，避免出现其它无关的内容，如注释和开关语句等。

  

* 最后，导入数据前须设置正确的日期时间格式。避免在导入过程中，因日期格式不正确造成导入失败。

  




### 指定 --table 选项时，有哪些注意事项？ 

参数 `--table` 用于指定的表名。

指定多个表时使用逗号分隔，且要求表名与文件名大小写保持一致。

例如：

* MySQL 模式下，如默认表名为小写，此时要求 `--table` 选项的值为小写表名，参数 `-f` 指定的目录下的文件名同样应为小写；

  

* Oracle 模式下，如默认表名为大写，要求 `--table` 选项的值为大写表名，参数 `-f` 指定的目录下的文件名同样应为大写。

  




### 公有云与私有云有什么区别？ 

* 公私有云的 proxyro 权限区别：

  * 公有云模式（限制模式）有 proxyro 权限限制，只能导出表数据，以及表和视图的结构；

    
  
  * 私有云模式（非限制模式）无 proxyro 权限限制，可导出数据库中所有数据库对象的结构和数据。

    
  

  

* 公私有云的连接方式区别：

  * 公有云：通过 `--public-cloud` 选项连接。

    
  
  * 私有云：通过 `--sys-password` 选项, 或提供秘钥文件连接。

    **说明**

    

    限制模式（公有云连接模式）会限制部分导入的功能、性能以及稳定性。同时，OceanBase 数据库 V2.2.30 及以上版本才支持服务端限流的能力，因此在使用限制模式时通过以下命令调整服务端限流：

    ```sql
    alter system set freeze_trigger_percentage=50;
    alter system set minor_merge_concurrence=64;
    alter system set writing_throttling_trigger_percentage=80 t
    ```

    
    
  

  




功能 FAQ 
---------------------------

### 如何在调试模式下运行 OBLOADER / OBDUMPER 以供排查问题？ 

直接运行 bin 目录下的调试脚本。例如：obloader-debug / obdumper-debug。

### 一张大表按照分块导出后，此时文件的后缀名不固定，在这种情况下如何使用 OBLOADER 导入呢？ 

可在命令中为文件的后缀选项指定正则表达式。

例如，文件名为 test.tbl.0、test.tbl.1 和 test.tbl，在命令行参数中指定 `--table test --file-suffix '^.{1}\\w+.{1}\\d+'` （用户需正确写出正则表达式，否则无法匹配到数据文件，提示数据文件未找到。）

### 如何使用 OBLOADER 导入与表不同名的数据文件？ 

通常情况下，-f 选项指定的是可见并且可读写目录的绝对路径。例如：`--table 't1,2' -f '/root/output'` 。但 -f 亦可直接指定一个数据文件。例如：`--table 'test' -f '/output/hello.csv'`。

### 为表配置了控制文件，导入或者导出数据时为何没有生效？ 

要求控制文件的名称与表名相同且大小写需一致（MySQL 默认表名是小写，Oracle 默认表名是大写）。

### 运行 OBLOADER / OBDUMPER 脚本时，命令行参数未被正常解析的原因是什么？ 

可能是命令行参数中存在特殊符号。Linux 平台上运行导入导出工具，密码中存在大于号（注：\> 是重定向符），导致运行的日志都会出现丢失。因此在不同的运行平台使用正确的引号进行处理。（参见下个问题）

### 运行 OBLOADER / OBDUMPER 脚本时，何时需对参数加单 / 双引号？ 

建议用户在一些复杂的参数上加上引号，例如：密码或集群名。

* Windows 平台参数使用双引号，例如：`--table "*"`；

  

* 类 Linux 平台参数使用单引号，例如：`--table '*'`。

  




### 外部文件格式不符合要求导致导入失败，应如何解决？ 

* 外部文件如为 SQL 文件。

  要求 SQL 文件里不能有注释和 SET 开关语句等，并且文件中只能有 INSERT 语句，每条语句不可以折断换行。除此以外，如文件中存在 DDL 或者其它 DML 语句等，建议使用 MySQL 命令导入。
  

* 外部文件如为 CSV 文件。

  CSV 文件需符合标准定义。要求有列分隔符、行分隔符。字符串类型的列值建议用引号包括起来，默认为单引号，同时对于被包括起来的列中出现单引号需实现转义。
  




### 导入表结构或数据时，有哪些注意事项？ 

* 导入表结构时，指定 `--threads` 并发数不超过 2 。并发 DDL 并不一定会加快速度，在 OceanBase 里， DDL 是串行执行的，每个 DDL 平均耗时 1 秒 。

  

* 导入大量的数据时，可能需占用较多的 OBLOADER 内存。

  * 首先可编辑 bin/obloader 脚本，修改 JVM 参数 `--Xms4G` 和 `--Xmx4G` ，分别表示 JVM 初始堆内存和最大堆内存，建议两者都设置为可用物理内存的 60%。

    
  
  * 其次，可在命令行中指定 `--threads` 选项用于控制并发，默认是 2 倍的逻辑 CPU 数量。

    
  
  * 最后，导入的性能还会受到表上的索引数量的影响。建议在建表时，除了主键和唯一键以外，索引留到数据导入结束后再创建。

    
  

  

* 导入时同时可能受租户的增量内存写入速度限制。

  * 如增量内存不足时会触发合并或转储。合并比较消耗性能，尽量不要触发。可开启内存的转储，并将转储的次数设置为 100 以上（通常足够坚持 24 小时 ）。

    
  
  * 如增量内存使用率达到租户限速阈值时，导入性能也会下降。

    
  
  * 如增量内存使用率已满，很容易导致数据导入失败。建议租户限速的阈值请问高于 90 。转储相关参数的设置跟租户内存的大小、写入速度都有关系，需根据实际情况进行调优。

    
  

  




编码 FAQ 
---------------------------

### 截断长串中文字符后出现乱码，应如何解决？ 

正确使用字符编码 GBK。
程序正确识别 【回车】和【换行】（解决 90% 的问题）。
**说明**



可能无法为客户模拟出脏数据。

### OBLOADER 导数出现数据篡写，应如何解决？ 

* 自导数工具 2.1.14 及之后版本，已禁止工具将数据导出到非空目录。

  

* 默认数据导出目录为空，新增 `--skip-check-dir` 参数，跳过导出数据目录为空检查。

  * Bug 示例：

    **说明**

    

    前提条件：命令行选项指定为 -f '目录'，如命令行选项指定为 -f '具体的文件' 则不会发生篡写。
    1. 一张表的表名是另外一张表的表名的前缀部分 (如：test、testtt)，且两张表的列类型相同（列名和列数可不同）。

       
    
    2. OBDUMPER 将多个库的结构和数据导出到同一个目录。

       ```unknow
       -- test及 testtt 相关schema
       
       create table test (
        c1 bigint,
         c2 varchar(20),
         ....
       );
       
       create table testtt (
        c1 bigint,
         c2 varchar(20)
       ); 
       ```

       
    

    
  
  * Bug 发现背景：

    POC 测试反馈业务中出现 **LIST_LOAN_BALANCE_S，LIST_LOAN_BALANCE_SEARCH** 的两张表，表名是前缀关系，表结构相似，最后导致篡写。
    
  

  




报错 FAQ 
---------------------------

### 启动 OBLOADER / OBDUMPER 时报错：Access denied for user 'root'@'xxx.xxx.xxx.xxx'。 

导入导出工具默认依赖 root@sys 用户和密码。如集群中已为 root@sys 用户设置密码，请在命令行中输入 `--sys-password` 选项并指定正确的 root@sys 用户的密码。

### 运行 OBLOADER 过程中报错：Over tenant memory limits。 

调大租户内存的占比（或指定 `--thread` 降低并发数）。

### 运行 OBLOADER 过程中报错：No memory or reach tenant memory limit。 

调大租户内存的占比（或指定 `--thread` 降低并发数）。

### 运行 OBLOADER 导入数据时，报错：No tables are exists in the schema: "xxx"。 

`--table 't1,t2'` 选项指定的 t1,t2 一定是数据库中已经定义的表名。同时，需注意大小写是否与数据库一致。

MySQL 默认表名是小写，Oracle 默认表名是大写。如 Oracle 中定义的表名为小写，表名需使用中括号，例如：`--table '[t1]'`。

### 运行 OBLOADER 导入数据时，报错：The xxx files are not found in the path: "xxx"。 

要求 -f 指定的目录中的数据文件的名称与表名相同且大小写要一致。

MySQL 默认表名是小写，Oracle 默认表名是大写。例如：`--table 't1'` 目录中的数据文件须为 t1.csv 或 t1.sql，不能是 T1.csv 或者其它的文件名。

### 运行 OBLOADER 导入数据时报错：The manifest file: "xxx" is missing。 

元数据文件 MANIFEST.bin 是 OBDUMPER 导出数据时产生的。使用其它工具导出的文件中无元数据文件。用户指定 `--external-data` 选项可跳过元数据文件的检查。

### 运行 OBLOADER 时导入 Delimited Text 格式时报错：Index：0，Size：0。 

出现这种错误的原因是数据中存在回车符/换行符，请先使用脚本删除数据中的回车符/换行符后再导入数据。
