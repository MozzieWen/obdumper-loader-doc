# 版本发布记录 

#RNDate#2022-11-23

本次 11 月发版的导数工具 4.0.0 旨在适配 OceanBase 驱动工具到 objdbc 2.4.0、导入/导出时支持 ORC 列存格式，以及规范导入/导出日志信息。

## 版本信息

* 当前版本：4.0.0

* 前置版本：3.3.2

* 发版时间：2022 年 11 月 23 日

## 支持的 OceanBase 数据库版本

OceanBase 导数工具 4.0.0 版本支持下表所列版本的 OceanBase 数据库。


|         **OceanBase 模式**         |                                               **支持的版本号**                                                |
|-------------------------|--------------------------------------------------------------------------------------------------------|
| Oracle 模式 | 2.0.x、2.1.x、2.2.20、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x、4.0.0                   |
| MySQL 模式  | 1.4.70、1.4.72、1.4.75、1.4.78、1.4.79、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x、4.0.0 |



## 功能变更  

* OBLOADER：

  * 适配 OceanBase 4.0.0 版本的 objdbc 2.4.0 驱动工具。

    
  
  * 支持将 `--orc` 格式的数据文件导入到 OceanBase 数据库中，查询时只读取涉及的列存数据以降低磁盘吞吐量。

  * 规范日志信息，包括列存、去 sys 租户依赖、普通表含非空唯一键性能优化。

  

* OBDUMPER：

  * 适配 OceanBase 4.0.0 版本的 objdbc 2.4.0 驱动工具。
    
  
  * 支持导出 `--orc` 格式的数据文件，查询时只读取涉及的列存数据以降低磁盘吞吐量。

    
  
  * 规范日志信息，包括列存、去 sys 租户依赖、普通表含非空唯一键性能优化。

## 问题修复

* 修复使用 OBDUMPER 导出数据后，将该数据通过 OBLOADER 导入到 OceanBase 数据库中时，Decimal 和 INT 数据类型字段变为默认值的缺陷。

* 修复使用 OBDUMPER 导出包含生成列的数据后，将该数据通过 OBLOADER 导入到 OceanBase 数据库中时语法报错的缺陷。

* 修复 OceanBase MySQL 模式下使用 OBDUMPER 导出 Float 类型数据时浮点数精度丢失的缺陷。

* 修复使用 OBDUMPER 导出数据时，指定 `--cut` 和 `--ddl` 选项不能导出 TYPE 类型的数据的缺陷。

* 修复使用 OBDUMPER 导出 CUT 格式文件时转义符丢失的缺陷。

* 修复使用 OBDUMPER 导出数据时，指定 `--file-name` 选项但未产生可以合并的文件导致所打印的日志级别报错的缺陷。

* 修复使用 OBDUMPER 导出 CSV/SQL 格式文件时，interval_day_to_second_column 和 interval_year_to_month_column 类型的数据缺失单引号的缺陷。

* 修复使用 OBDUMPER 导出单库中大量数据时出现报错的缺陷。

* 修复 OceanBase MySQL 模式下连接 ODP (Sharding) 逻辑库且使用 OBLOADER 导入 KEY 分区表数据时，OceanBase Database Proxy (ODP) 显示内存不足且 OBLOADER 运行报错的缺陷。

* 修复 OceanBase Oracle 模式下使用 OBDUMPER 无法导出公共同义词的缺陷。

* 修复使用 OBLOADER 导入数据时，OBServer 宕机导致报错的缺陷。

* 修复 Windows 系统下使用 OBLOADER 3.3.0 版本导入 CUT 格式文件时报错的缺陷。

* 修复使用 OBLOADER 导入数据时，指定 `--max-discards` 选项为整数出现完成状态和数据行数记录混乱的缺陷。

* 修复使用 OBLOADER 导入数据时，因数据中包含不存在的数据库对象选项导致执行结果不一致的缺陷。

* 修复使用 OBLOADER 导入 CUT 格式文件时，指定 `--skip-footer` 和 `--ctl-path` 选项导致数组越界的缺陷。

* 修复使用 OBLOADER 导入 DDL 格式文件时，因指定 `--replace-object` 命令无法覆盖数据库中已存在的表组定义导致导入失败的缺陷。

* 修复使用 OBLOADER 导入 DDL/MIX 格式文件时，不能通过 `-f` 选项指定数据文件绝对路径的缺陷。

* 修复使用 OBLOADER 导入数据时，通过 `-f` 选项指定的数据文件为空出现报错的缺陷。

* 修复使用 OBLOADER 导入数据时，指定 `--max-errors`/`--max-discards` 选项到达指定的错误/重复数量停止导入后，显示 `count` 数目与实际不符缺陷。

* 修复使用 OBLOADER 导入数据时，指定 `--max-discards` 选项不生效且.discard 日志中记录不全且重复的缺陷。

* 修复使用 OBLOADER 导入数据时，同时指定 `--max-errors` 和 `--max-discrads` 选项显示 `Error: null` 的缺陷。



* 修复日志信息不能够准确定位的缺陷。


## 已知问题

* 分区键为字符类型且字符集为 UTF16 和 GB18030 时，会打印 WARN 级别日志信息，提示无法计算分区信息，但不影响数据实际导入。

* 使用控制文件导入时，如果 `--table` 指定的表名大小写必须与数据库中的保持一致，否则控制文件无法生效。

* 限制模式下导出的表定义和视图定义会带有 Schema 信息。

* 限制模式下，OceanBase Oracle 2.2.50 之前版本中不支持导出表索引的定义。

* 限制模式下，OceanBase 2.2.70 之前版本不支持导出表组的定义。

* 限制模式下，OceanBase 2.2.70 及之后版本无法导出分区表唯一索引。

* 限制模式下，使用 OceanBase 2.2.70 之前版本通过一致性查询导出的数据不具备一致性。

* 非限制模式下，使用 OceanBase Oracle 2.2.50 之前版本在无主建分区表中创建 Global 类型索引时会导致所有表定义无法导出。

* 非限制模式下，使用 OceanBase MySQL/Oracle 3.3.2 版本导出的表定义中表组信息丢失。

* 非限制模式下，使用 OceanBase 2.2.70 之前版本通过一致性查询导出的非分区且无主建表中的数据不一致。

* MySQL 租户暂不支持导出序列对象。

* 修复使用 OBLOADER 导入 MIX 格式文件时存在 `COMMIT;` 语句的缺陷。



## 注意事项


* 导出 CUT 格式文件时，如果字段内容中出现指定的字段分隔符，会对字段中的分隔符字符进行转义。例如：字段内容为 `abc|def`，指定分隔符为 | （`--column-splitter "|"`），则导出的字段内容会转换为 `abc\|def`。

* `--logical-database` 选项用于通过  OceanBase Database Proxy (ODP) (Sharding) 实现对逻辑库的导入导出，当前受限于 OceanBase Database Proxy (ODP) (Sharding) 的功能，通过 OBDUMPER 导出的表定义是分库分表中随机的一个物理表定义，因此无法直接通过 OBLOADER 导入到逻辑库中，需要用户手动修改表定义。

* `--no-sys` 选项用于标识私有云环境下无 sys 租户密码的使用场景，相当于导数工具 3.2.0 及之前版本在私有云环境下使用 `--public-cloud` 选项的效果。导数工具 3.3.0 及之后版本对公共云环境和私有云环境进行了区分，`--public-cloud` 选项仅用于公共云环境，`--no-sys` 选项仅用于私有云环境。

## 限制模式

> **说明**  
> 限制模式仅适用于用户无法直接提供 `--sys-user` 和 `--sys-password` 选项的场景。
> 限制模式（`--no-sys`）适用于私有云环境下无 sys 租户密码的场景，限制模式（`--public-cloud`）适用于公共云环境下无 sys 租户密码的场景。

使用限制模式（`--public-cloud`）连接公共云部署的 OceanBase 集群时无需指定 `-t`, `-c` 连接选项；使用限制模式（`--no-sys`）连接从私有云部署的 OceanBase 集群时需要指定 `-t` 连接选项，连接 ODP 服务时还需要加上 `-c` 选项。