# 导数工具 3.1.0


本次 4 月发版的导数工具 3.1.0 支持使用密钥文件、设置会话级别变量、准确定界数据文件、导出数据时支持所有格式的数据预处理功能、导出结构时支持导出表组的相关信息和导出 Date 类型时支持导出 to_date() 函数，并优化导入数据时的大文件拆分逻辑和导出含有主键表时的分页查询等功能。

版本信息 
-------------------------

* 当前版本：3.1.0

  

* 前置版本：3.0.0

  

* 发版时间：2022 年 4 月 10 日

  




支持的 OceanBase 数据库版本 
----------------------------------------

OceanBase 导数工具 3.1.0 版本支持下表所列版本的 OceanBase 数据库。


|         **OceanBase 模式**         |                                               **支持的版本号**                                                |
|-------------------------|--------------------------------------------------------------------------------------------------------|
| Oracle 模式 | 2.0.x、2.1.x、2.2.20、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x                    |
| MySQL 模式  | 2.0.x、2.1.x、2.2.20、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x |



功能变更 
-------------------------

* OBLOADER & OBDUMPER：

  * 使用密钥文件来实现导数需求，避免用户在命令行直接使用 sys 租户的密码。

    
  
  * 支持准确定界数据文件（`--cut`、`--csv` 和 `--sql` 格式）。

    
  

  

* OBLOADER：

  * 丰富了控制文件支持的预处理函数。

    
  
  * 优化导入数据时的大文件拆分逻辑，从而提升切分的精准度。

    
  

  

* OBDUMPER：

  * 支持设置会话级别变量，包括 `ob_query_timeout`、`ob_trx_timeout`、`net_read_timeout`、`net_write_timeout` 和 `proxy_route_policy`。

    
  
  * 导出数据时支持所有格式的数据预处理功能，包括 `--cut`、`--csv` 和 `--sql` 格式。

    
  
  * 导出含有主键表时，对分页查询进行了优化（相比普通流式查询，导出功能更加稳定）。

    
  
  * 导出结构时支持导出表组的相关信息。

    
  
  * 按照 SQL 格式导出 Date 类型时支持导出 to_date() 函数（仅支持 SQL 格式）。

    
  

  




问题修复 
-------------------------

* 修复使用 OBLOADER 导入数据时，`--public-cloud` 参数失效的缺陷。

  

* 修复使用 OBDUMPER 导出结构时，全局索引导出报错的缺陷。

  




已知问题 
-------------------------

* OBLOADER & OBDUMPER：命令行参数指定的对象名、数据文件名、规则文件名要求大小写一致（Oracle 默认大写，MySQL 默认小写）。

  

* OBLOADER：

  * 数据库中存在有外键的表时，无法保证结构和数据按照依赖顺序导入，可能会导入失败。

    
  
  * OceanBase Oracle 模式不支持导入导出虚拟列的数据（已修复 OceanBase MySQL 模式，导出数据时忽略虚拟列，否则无法导入虚拟数据）。

    
  
  * OceanBase MySQL 模式 1.4.x 版本 RANGE_COLUMNS + KEY 在虚拟路由视图中的元数据有缺陷。

    
  

  

* OBDUMPER：

  * 外键包含多列时，不保证导出的列的顺序。例如：`FOREIGN KEY(c1,c2) REFERENCE(c1,c2)`。

    
  
  * OceanBase 数据库 MySQL 模式 1.4.72 版本不支持唯一前缀索引定义的导出。例如：`UNIQUE(c1(10))`。

    
  
  * OceanBase 数据库 MySQL 模式 1.4.79 版本使用 `insert ... where not exists` 句型解决主键冲突时，可能存在跨分区插入的问题。

    
  
  * OceanBase 数据库 Oracle 模式 2.2.50 之前的版本中，不支持导出函数索引的结构定义语句。

    
  
  * OceanBase 数据库 MySQL 模式 2.2.7x 不支持导出垂直分区。例如：partition by column。

    
  
  * OceanBase 数据库 MySQL 模式 2.2.7x 不支持导出同义词。例如如：create synonym。

    
  
  * OceanBase 数据库 MySQL 模式 2.2.7x 不支持导出索引的存储列。例如：storing(column_list)。

    
  
  * 不支持导出 interval day(2) to second(0) 数据类型。例如：'0 5:0:0.000000'。

    
  
  * 在 OceanBase Oracle 模式下，number(n,m) 类型的数据，小于 1 的数据，导出数据为科学计数法形式。例如：0.0000007 导出为 7E-7。

    
  

  




注意事项 
-------------------------

* 标准的 CSV 格式可阅读 RFC 4180 规范，推荐导入导出操作严格遵从 RFC 4180 规范。

  

* 导入导出大规模的数据量时，请在运行的脚本中修改虚拟机的内存参数（默认：-Xms4G -Xmx4G）。

  

* 导入的数据文件命名格式，统一为：table.group.sequence.suffix。

  

* 无主键的表，暂不支持中断续传。

  

* 导入时，要求指定的对象名与数据文件名大小写一致。如果数据库中同时存在大写和小写的对象，那么小写的对象名和文件名需要使用双引号包含起来。

  

* 在 Windows 系统上，数据库对象的名称不可包含 \\ / : \* ? " \< \> \| 否则无法正常导出。

  

* 在 windows 系统上，不能使用 ！做分隔符。

  

* OBLOADER 支持的文件格式如下所示：

  * DDL 文件格式：文件中仅包含 DDL 语句。

    
  
  * SQL 文件格式：文件中的仅包含 `INSERT` 语句，记录不跨行。

    
  
  * MIX 混合文件格式：文件中包含 DDL 和 DML 等多种混合的语句。

    
  
  * POS 文件格式：文件中的数据是根据字节（非字符）偏移位置产生的。

    
  
  * CUT 文件格式：文件中的数据是根据字符串分隔，区别于 CSV 格式的单个字符分隔。

    
  

  




限制模式 
-------------------------

**说明**



此限制模式仅限于公有云部署的服务。

* 如用户未使用限制模式，导入导出工具仍旧依赖 root@sys (默认) 或 proxyro@sys 两个用户。

  

* 使用限制模式（`--public-cloud`）导出数据时，仅支持导出表中的数据。

  

* 使用限制模式（`--public-cloud`）导出结构时，仅导出 TABLE 和 VIEW 两种对象类型的定义，其中 TABLE 类型的结构不包含索引定义。其导出的表结构不完善，缺少索引信息。且导出数据的性能比非限制版低。

  

* 使用限制模式（`--public-cloud`）于公有云相关的服务时，无需指定 `-t`、`-c` 连接选项。

  

* 截至到当前版本，ALL_SOURCE 视图缺少 TYPE 相关信息，OBDUMPER 无法导出 TYPE 定义。

  

* OBLOADER 可通过指定 `--public-cloud` 选项使用限制模式导入数据。在限制模式下 OBLOADER 不依赖系统租户下的任何用户，即无需指定 `--sys-user` 和 `--sys-password` 选项。

  

* 限制模式会限制部分导入的功能、性能以及稳定性。同时，OceanBase 数据库 2.2.30 及以上版本才支持服务端限流的能力，因此在使用限制模式时通过以下命令调整服务端限流：

  ```sql
  alter system set freeze_trigger_percentage=50;
  alter system set minor_merge_concurrence=64;
  alter system set writing_throttling_trigger_percentage=80 tenant='xxx';
  ```

  



