产品简介 
=========================



什么是 OBDUMPER 
---------------------------------

OBDUMPER 是一款使用 Java 开发的客户端导出工具。该工具可将 OceanBase 中的数据按照 SQL 或者CSV 格式导出至文件中。同时，可利用该工具将数据库中定义的对象导出至文件中。

与 MyDumper 和 SQLDeveloper 等导出工具相比，OBDUMPER 在功能和性能上具备以下显著优势：

* 高性能

  在无主键表和分区表等场景下，已提供针对性的性能优化。
  

* 功能多

  提供数据限量导出、数据格式多样和全局一致性非锁定导出等功能。
  




产品功能 
-------------------------

OBDUMPER 提供将 OceanBase 数据库中的对象结构和表中的数据导出至文件中，主要具备以下功能特性：

* 支持导出数据库中对象的结构定义语句（DDL）。

  

* 支持将表中的数据按照 CSV 或者 SQL 格式导出至文件中。

  

* 对于分区表，可指定分区名导出部分分区内的数据。

  

* 可指定全局的过滤条件，仅导出满足条件的数据。

  

* 支持配置简单的数据处理规则。

  

* 支持全局一致非锁定读取，保证导出的数据的全局一致性。

  

* 支持基于 SCN/TIMESTAMP 闪回查询，保证导出数据的全局一致性。

  

* 支持通过限制模式导出数据，限制模式不依赖系统租户下的任意账号信息。

  

* 支持 OBDUMPER 将数据导出并上传到 Aliyun OSS 的功能。

  

* 支持多表导出单表数据文件合并，解决导出文件数量过多的问题。

  

* 支持导出结构时包含 `TABLEGROUP `信息。

  

* 支持从 OB 集群的备副本中读取备份数据。

  

* 自定义 SQL 结果集导出时，支持 SQL、CSV、CUT 三种数据文件格式。

  




支持的 OceanBase 数据库 
--------------------------------------

支持连接的 OceanBase 数据库版本如下表所示：


|         **数据库**         |                                               **支持的版本**                                                |
|-------------------------|--------------------------------------------------------------------------------------------------------|
| OceanBase 数据库 Oracle 模式 | V2.2.30、V2.2.52、V2.2.7x、V3.1.x、V3.2.x                                                                  |
| OceanBase 数据库 MySQL 模式  | V1.4.70、V1.4.72、V1.4.75、V1.4.78、V 1.4.79、V2.2.30、V2.2.50、V2.2.70、V2.2.71、V2.2.72、V2.2.76、V3.1.x、V3.2.x |


**注意**



自导数工具 V3.0.0 版本起，导数工具支持 OceanBase 社区版。

社区版导数工具（OBLOADER \& OBDUMPER）需搭配社区版 OceanBase V3.1.2 及以上版本使用。

注意事项 
-------------------------

* 外键定义包含多列，导出时不保证列的顺序。例如： `FOREIGN KEY(c1,c2) REFERENCE (c1,c2)`。

  

* OceanBase 数据库 MySQL 模式 V1.4.72 版本不支持导出唯一前缀索引的结构定义，例如： `UNIQUE(c1(10))` 。

  

* OceanBase 数据库 MySQL 模式 V1.4.x 版本不支持导出生成列的定义，例如：`GENERATED ALWAYS AS (expr)`。

  

* OceanBase 数据库 Oracle 模式 V2.2.50 之前的版本中，不支持导出函数索引的结构定义语句。

  

* 标准的 CSV 格式可以阅读 RFC 4180 规范，推荐导入导出严格遵从这种格式。

  

* 导入导出大规模的数据量时，请在运行的脚本中，修改虚拟机的内存参数（默认：-Xms4G -Xmx4G）。

  

* 要求参数中指定的对象名、数据文件名、规则文件名大小写一致。Oracle 默认大写，MySQL 默认小写。

  

* 导出数据时，建议用户先触发一次合并，由此可在一定程度上提升导出的性能。

  

* 导出数据的文件命名格式，统一为：table.group.sequence.suffix。

  

* OceanBase 数据库 MySQL 模式 V2.2.7x 不支持导出垂直分区。例如：partition by column。

  

* OceanBase 数据库 MySQL 模式 V2.2.7x 不支持导出同义词。例如如：create synonym。

  

* OceanBase 数据库 MySQL 模式 V2.2.7x 不支持导出索引的存储列。例如：storing(column_list)。

  

*
  截至当前版本，ALL_SOURCE 视图缺少 TYPE 相关信息，OBDUMPER 无法导出 TYPE 定义。
  

* 在 Windows 系统上，数据库对象的名称不可包含 \\ / : \* ? " \< \> \| 否则无法正常导出。

  

* 在 windows 系统上，不能使用 ！做分隔符。

  

* 不支持导出 `interval day(2) to second(0)` 数据类型，例如：`'0 5:0:0.000000'`。

  




限制模式 
-------------------------

**说明**



此限制模式仅适用于公有云部署的服务。

* OBDUMPER 可通过指定 `--public-cloud` 选项使用限制模式导出数据。在限制模式下 OBDUMPER 不依赖系统租户下的任何用户，即无需指定 `--sys-user` 和 `--sys-password` 选项。

  

* 如用户未使用限制模式，导入导出工具仍依赖 root@sys (默认)或 proxyro@sys 两个用户。

  

* 使用限制模式（`--public-cloud`）导出数据时，仅支持导出表中的数据。

  

* 使用限制模式（`--public-cloud`）导出结构时，仅导出 TABLE 和 VIEW 两种对象类型的定义，其中 TABLE 类型的结构不包含索引定义。其导出的表结构不完善，缺少索引信息。且导出数据的性能比非限制版低很多。

  

* 使用限制模式（`--public-cloud`）于公有云相关的服务时，无需指定 `-t`、`-c` 连接选项。

  




使用条件 
-------------------------

当前版本对于 `undo_retention` 变量的设置与使用有一些要求。

该参数默认为 0，默认单位是秒。假设 t1 为撤回（Undo）操作的时间点，且 t2 = t1 + 900s，那么在 t2 时间点可以查询至 [t1,t2] 区间内的数据。设置 `undo_retention` 后，当前的会话对 t1 时间点之前的数据不起作用，仅对 t1 之后的时间点的数据才起作用。以下语句展示了如何设置 `undo_retention` 变量：

```javascript
SET global undo_retention=900;
```



* OceanBase 有效的 SCN 可通过视图 `v$ob_timestamp_service` 获取，目前只能在 sys 租户下查询。

  

* 查询固定时间点可查询最近的一次合并版本。例如，在 t1 时间点发起了集群合并，最早可查询至 t1 时间点的数据。

  

* 如果被查询的表已被删除且放置在回收站，则需先将该表从回收站中恢复。

  

* 闪回查询受限于转储，如发生转储，且 `undo_retention` 变量未设置，则无法查询。设置 `undo_retention` 变量后，可查询 t1（转储时间点）+ `undo_retention` 变量设置的时间范围。

  



