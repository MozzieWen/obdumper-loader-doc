# 版本发布记录 

#RNDate#2022-12-09

本次 11 月发版的导数工具 4.0.0 旨在主要新增支持导入导出 ORC, Parquet 列存格式（默认：压缩）、新增支持导入导出 TYPE 对象的定义，弱化产品对于 sys 租户的权限依赖、优化数据导出性能（优化范围：定义主键的表或者定义非空唯一键的表）、升级底层依赖的组件版本，JDBC 驱动 (升级到 2.2.11)、分区计算组件（升级到 1.4.0-RELEASE）以及修复历史版本中若干功能缺陷。

## 版本信息

* 当前版本：4.0.0

* 前置版本：3.3.2

* 发版时间：2022 年 12 月 09 日

## 支持的 OceanBase 数据库版本

OceanBase 导数工具 4.0.0 版本支持下表所列版本的 OceanBase 数据库。


|         **OceanBase 模式**         |                                               **支持的版本号**                                                |
|-------------------------|--------------------------------------------------------------------------------------------------------|
| Oracle 模式 | 2.0.x、2.1.x、2.2.20、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x、4.0.0                   |
| MySQL 模式  | 1.4.70、1.4.72、1.4.75、1.4.78、1.4.79、2.2.30、2.2.50、2.2.70、2.2.71、2.2.72、2.2.76、3.1.x、3.2.x、4.0.0 |



## 功能变更  

* OBLOADER：

  * 新增 `--orc` 和 `--par` 选项，支持将 ORC, Parquet 格式的数据文件导入到 OceanBase 数据库中。

  

* OBDUMPER：

  * 新增 `--orc` 和 `--par` 选项，支持将表中的数据导出到 ORC, Parquet 格式的数据文件中。
    
  
  * 新增 `--type` 选项，支持导出 TYPE 对象定义。

    
  
  * 弱化对 sys 租户权限的依赖。未指定 sys 租户密码和指定 sys 租户密码的功能差异如下：
    ![1](https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/doc/img/obloaderobdumper/400/400.png)

## 问题修复

* 修复 obdumper 在 OceanBase Oracle 2.2.30 版本，导出分区索引报语法错误的缺陷。
* 修复 obdumper 命令行指定 --cut 选项导出数据中存在 null，导入程序将 null 当作 'null' 字符串的缺陷。
* 修复 obdumper 无法导出 OceanBase Oracle 租户中公共同义词的缺陷。
* 修复 obdumper 无法导出 OceanBase 2.2.77 以及之前版本的 TABLEGROUP 的分区信息的缺陷。
* 修复 obdumper 命令行指定 --sql 选项导出数据时，Insert SQL存在未换行的缺陷。
* 修复 obdumper 命令行未指定 sys 租户密码时，OceanBase Oracle 租户导出的列注释语法错误的缺陷。
* 修复 obdumper 一致性导出时可能因为提前关闭PS导致程序报 NPE 的缺陷。
* 修复 obdumper 一致性导出无法导出最近一次合并的基线版本数据的缺陷。
* 修复 obdumper 在 OceanBase 4.0.0.0 版本中导出 TYPE 类型定义，再导入失败的缺陷。
* 修复 obdumper 在 OceanBase 4.0.0.0 版本中导出分区索引报错的缺陷。
* 修复 obdumper 在 OceanBase 4.0.0.0 版本中查询索引分区时数据库版本判断存在错误的缺陷。
* 修复 obdumper 命令行未指定 --ddl，csv 以及其他数据格式选项，程序不拦截的缺陷。
* 修复 obloader 命令行指定 --mix 选项导入文件必须要和 --table 搭配使用的易用性缺陷。
* 修复 obloader 命令行指定 --mix 选项导入文件中存在的 TABLEGROUP 定义程序会报错的缺陷。
* 修复 obloader 向多副本集群导入数据时如果发生部分节点宕机，所有数据都无法导入的缺陷。
* 修复 obloader 使用控制文件做字段映射时，导入数据可能会出现数组越界的缺陷。
* 修复 obloader 导入数据库对象定义不支持指定路径缺陷。
* 修复 obloader 在 OceanBase 4.0.0.0 版本导入包含生成列的表结构失败的缺陷。


## 已知问题

* 导出的数据库对象定义中可能会带上对象所属的数据库名。
* 命令行未指定 sys 租户密码时，OceanBase 2.2.70之前的版本均不支持导出表组定义。
* 命令行未指定 sys 租户密码时，OceanBase Oracle 2.2.50之前的版本中无法导出索引定义。
* 命令行未指定 sys 租户密码时，OceanBase Oracle  2.2.70之前的版本无法导出唯一索引的分区信息。
* 命令行未指定 sys 租户密码时，OceanBase Oracle 2.2.70及之后的版本无法导出分区表的唯一索引定义。
* OceanBase MySQL 租户暂不支持导出 SEQUENCE 对象定义。
* OceanBase MySQL 2.2.30之前的版本中均不支持导出PL对象定义。
* Windows 操作系统上，命令行指定 --cut 选项导入文件时存在缺陷。



## 注意事项

* 命令行指定 `--cut` 选项导出的数据中存在字段分隔符，默认程序会对数据中的分隔符进行转义。例如：字段内容为 `abc|def`，分隔符为 `|`，则导出的字段为 `abc\|def`。

* 命令行指定 `--cut` 选项导入数据时，如果文件中的数据行尾没有字段分隔符（或分隔串），请勿使用 `--trail-delimiter` 选项，否则导入程序会出现严重错误。

* 命令行中指定 `--logical-database` 选项时，导出的是随机的一个物理分库分表的定义，不可以直接导入到数据库中。用户需要将导出的物理库表结构手动改成逻辑库表结构，才可以导入到数据库中被业务使用。

* 导入导出使用控制文件时，命令行指定的 `--table` 选项所包含的表名必须和数据库中定义的表名以及控制文件名保持大小写一致，否则控制文件无法被程序识别。

* 命令行指定 `--partition` 选项导出分区内的数据时，对于组合分区表需要指定二级分区名，导出工具无法导出一级分区内的数据。如果指定的分区名不存在，导出程序会报错提示。

* 命令行指定 `--add-extra-message` 选项导出表定义时，程序会导出每张表所属的表组名。该选项依赖 sys 租户权限。如果导出程序运行时缺少 sys 租户的权限，请勿指定该选项。

* OceanBase 3.2.4.0 及以后的版本中使用导入导出工具前，请将系统配置项 `open_cursors` 设置为较大的值，否则导入导出程序可能会出现错误。数据导入导出结束后，请将该系统配置项重置成初始值。例如：`ALTER SYSTEM SET open_cursors = 65535；`

* OceanBase 4.0.0.0 及以后的版本中表结构发生过任意的变更操作，导出工具无法导出该表最近一次成功合并的基线数据（即一致性快照数据），用户可以手动发起一次合并以后，再重新导出最近一次成功合并的基线数据。